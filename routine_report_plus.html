<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸŒ¸ ìŠ¤ë§ˆíŠ¸ ì•ŒëŒ ë¦¬í¬íŠ¸ â€” Pink Edition</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: 'ë§‘ì€ ê³ ë”•', sans-serif;
    background: linear-gradient(180deg, #ffe6f0 0%, #fff8fb 100%);
    color: #444;
    text-align: center;
    padding: 30px;
  }
  h1 { color: #ff5c8a; margin-bottom: 5px; }
  h2 { color: #ff7aa2; font-weight: normal; }
  .summary {
    display: flex; justify-content: center; gap: 30px; flex-wrap: wrap;
    margin: 25px 0;
  }
  .card {
    background: rgba(255,255,255,0.8);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    box-shadow: 0 4px 15px rgba(255, 92, 138, 0.15);
    padding: 20px; width: 200px; transition: transform .25s;
  }
  .card:hover { transform: scale(1.05); }
  .card h3 { color:#ff5c8a; margin-bottom: 5px; }
  .card p { font-size: 22px; font-weight: bold; margin:0; color:#555; }
  #commentBox {
    background: rgba(255,255,255,0.85);
    border-radius: 16px;
    padding: 20px;
    margin: 25px auto;
    width: 600px;
    box-shadow: 0 4px 15px rgba(255, 92, 138, 0.1);
    color: #444; font-size: 17px;
  }
  canvas {
    margin-top: 25px;
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 4px 15px rgba(255, 92, 138, 0.15);
    padding: 10px;
  }
</style>
</head>
<body>
  <h1>ğŸŒ ìŠ¤ë§ˆíŠ¸ ì•ŒëŒ ë¦¬í¬íŠ¸</h1>
  <h2>Party's Daily Feedback</h2>

  <div class="summary">
    <div class="card"><h3>ğŸ“ˆ í‰ê·  ì ìˆ˜</h3><p id="avgScore">-</p></div>
    <div class="card"><h3>ğŸ† ìµœê³  ì ìˆ˜</h3><p id="maxScore">-</p></div>
    <div class="card"><h3>ğŸ“… ì£¼ê°„ íŒ¨í„´</h3><p id="pattern">-</p></div>
  </div>

  <div id="commentBox">ğŸ©· Party ì½”ë©˜íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <canvas id="wakeChart" width="700" height="350"></canvas>

<script>
function loadData(){
  const data = JSON.parse(localStorage.getItem("smart_alarm_analyzed")||"[]");
  return data.slice(-7);
}

function renderReport(){
  const records = loadData();
  if(records.length===0){ alert("ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤!"); return; }

  const labels = records.map(r=>r.date);
  const scores = records.map(r=>r.wakeScore);
  const avg=(scores.reduce((a,b)=>a+b,0)/scores.length).toFixed(1);
  const max=Math.max(...scores).toFixed(1);
  const days=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];
  const freq={}; records.forEach(r=>{const d=days[new Date(r.date).getDay()];freq[d]=(freq[d]||0)+1;});
  const topDay=Object.entries(freq).sort((a,b)=>b[1]-a[1])[0][0];

  document.getElementById("avgScore").innerText=avg+"ì ";
  document.getElementById("maxScore").innerText=max+"ì ";
  document.getElementById("pattern").innerText=`${topDay}ìš”ì¼ì— ê°€ì¥ ìì£¼ ì¼ì–´ë‚¬ì–´ìš” â˜€ï¸`;

  const latest=scores[scores.length-1];
  const commentBox=document.getElementById("commentBox");
  const comments={
    high:["ì™„ë²½í•œ ì•„ì¹¨ì´ì—ìš” ğŸ”¥","ì˜¤ëŠ˜ ì—ë„ˆì§€ ë§Œë•…! â˜€ï¸","ì´ ê¸°ì„¸ë¡œ í•˜ë£¨ ì¢…ì¼ íŒŒì´íŒ… ğŸ’ª"],
    mid:["ì¢‹ì•„ìš”, ê¾¸ì¤€í•¨ì´ ë©‹ì ¸ìš” ğŸŒ¸","ì¡¸ë ¸ì§€ë§Œ í•´ëƒˆì–´ìš” â˜•ï¸","í¬ê¸°í•˜ì§€ ì•Šì•˜ë„¤ìš” ğŸ‘"],
    low:["ì¡°ê¸ˆ í”¼ê³¤í–ˆì£ ? ë‚´ì¼ì€ ì¼ì° ìë³¼ê¹Œìš” ğŸŒ™","ê´œì°®ì•„ìš”, ê¾¸ì¤€íˆ í•˜ë©´ ë¼ìš” ğŸ’—","ì¡°ìš©íˆ ì¼ì–´ë‚¬ì§€ë§Œ ì „ì§„ì´ì—ìš” âœ¨"]
  };
  const set=latest>=90?comments.high:latest>=75?comments.mid:comments.low;
  const pick=set[Math.floor(Math.random()*set.length)];
  commentBox.innerHTML=`<b>ì˜¤ëŠ˜ ì ìˆ˜: ${latest.toFixed(1)}ì </b><br>${pick}`;

  const ctx=document.getElementById('wakeChart').getContext('2d');
  new Chart(ctx,{
    type:'line',
    data:{
      labels,
      datasets:[{
        label:'ê¸°ìƒ í’ˆì§ˆ ì ìˆ˜',
        data:scores,
        borderColor:'#ff5c8a',
        backgroundColor:'rgba(255,92,138,0.25)',
        pointBackgroundColor:'#ff85a2',
        pointBorderColor:'#fff',
        fill:true,
        tension:0.4,
        borderWidth:3
      }]
    },
    options:{
      plugins:{
        legend:{display:false},
        tooltip:{
          backgroundColor:'#fff',
          titleColor:'#ff5c8a',
          bodyColor:'#555',
          borderColor:'#ff9ec4',
          borderWidth:1
        }
      },
      scales:{
        x:{
          ticks:{color:'#ff7aa2',font:{weight:'bold'}},
          grid:{color:'rgba(255,182,204,0.2)'}
        },
        y:{
          ticks:{color:'#ff7aa2',font:{weight:'bold'}},
          grid:{color:'rgba(255,182,204,0.2)'}
        }
      }
    }
  });
}
document.addEventListener("DOMContentLoaded",renderReport);
</script>
</body>
</html>
